
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description
     *   Regras para a coleção de submissões de formulário de contato.
     *   Permite que qualquer pessoa crie (envie o formulário), mas apenas
     *   usuários autenticados (admin) possam ler.
     */
    match /contactFormSubmissions/{contactFormSubmissionId} {
      /**
       * @description
       *   Permite a criação de um novo envio de formulário por qualquer pessoa.
       *   Isso funciona como um "dropbox" seguro.
       */
      allow create: if request.auth == null;

      /**
       * @description
       *   Permite a leitura de um documento individual (get) e a listagem de toda
       *   a coleção (list) apenas se o usuário estiver autenticado.
       *   Crucial para a página de admin.
       */
      allow get, list: if request.auth != null;
      
      /**
       * @description
       *   Ninguém pode atualizar ou deletar envios através do cliente.
       */
      allow update, delete: if false;
    }

    /**
     * @description
     *   Regras para a coleção de depoimentos. Estes dados são públicos.
     */
    match /testimonials/{testimonialId} {
      allow get, list: if true;
      allow create, update, delete: if false; // Gerenciado apenas pelo lado do servidor/admin
    }
  }
}
